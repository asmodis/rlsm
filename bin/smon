#!/usr/bin/env ruby
require File.join(File.dirname(__FILE__), '..', 'lib', 'smon', 'smon')
require 'optparse'

Version = RLSM::VERSION
out = STDOUT

opts = OptionParser.new do |op|
  op.banner = <<USEAGE
Usage: smon [-oh] [FILE1 FILE2 ...]
Executes each FILE as smon script or if no file is given
starts in interactive mode.

USEAGE
  op.separator("Options:")

  op.on('-o', '--out FILE', "Output is redirected to FILE.") do |f|
    out = File.open(f, 'w')
  end

  op.on_tail('-h', '--help', "This help.") { puts op; exit }
  op.on_tail('--version', "Shows version.") { puts op.ver }
end

begin
  opts.parse! ARGV

  SMON.new :files =>ARGV, :messenger => out
rescue => e
  STDERR.puts "Error: #{e.message}"
  STDERR.puts
  STDERR.puts opts
  exit 1
end
